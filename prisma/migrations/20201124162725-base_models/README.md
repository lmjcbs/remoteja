# Migration `20201124162725-base_models`

This migration has been generated by lmjcbs at 11/24/2020, 4:27:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "jobs" (
"id" SERIAL,
    "jid" TEXT NOT NULL,
    "apply_email" TEXT,
    "apply_info" TEXT NOT NULL,
    "apply_url" TEXT,
    "company_name" TEXT NOT NULL,
    "company_logo_url" TEXT,
    "description" TEXT NOT NULL,
    "epoch" INTEGER NOT NULL,
    "pinned" BOOLEAN NOT NULL,
    "salary_currency" TEXT NOT NULL,
    "salary_max" INTEGER NOT NULL,
    "salary_min" INTEGER NOT NULL,
    "title" TEXT NOT NULL,
    "location_id" INTEGER NOT NULL,
    "category_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "categories" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "locations" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "tags" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_JobToTag" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "jobs.jid_unique" ON "jobs"("jid")

CREATE INDEX "locationId" ON "jobs"("location_id")

CREATE INDEX "categoryId" ON "jobs"("category_id")

CREATE UNIQUE INDEX "categories.name_unique" ON "categories"("name")

CREATE UNIQUE INDEX "locations.name_unique" ON "locations"("name")

CREATE UNIQUE INDEX "tags.name_unique" ON "tags"("name")

CREATE UNIQUE INDEX "_JobToTag_AB_unique" ON "_JobToTag"("A", "B")

CREATE INDEX "_JobToTag_B_index" ON "_JobToTag"("B")

ALTER TABLE "jobs" ADD FOREIGN KEY("location_id")REFERENCES "locations"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "jobs" ADD FOREIGN KEY("category_id")REFERENCES "categories"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_JobToTag" ADD FOREIGN KEY("A")REFERENCES "jobs"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_JobToTag" ADD FOREIGN KEY("B")REFERENCES "tags"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201124162725-base_models
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,67 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Job {
+  id             Int      @id  @default(autoincrement())
+  jid            String   @unique
+  applyEmail     String?  @map("apply_email")
+  applyInfo      String   @map("apply_info")
+  applyUrl       String?  @map("apply_url")
+  companyName    String   @map("company_name")
+  companyLogoUrl String?  @map("company_logo_url")
+  description    String
+  epoch          Int
+  pinned         Boolean
+  salaryCurrency String   @map("salary_currency")
+  salaryMax      Int      @map("salary_max")
+  salaryMin      Int      @map("salary_min")
+  title          String
+  locationId     Int      @map("location_id")
+  categoryId     Int      @map("category_id")
+  location       Location @relation(fields: [locationId], references: [id])
+  category       Category @relation(fields: [categoryId], references: [id])
+  tags           Tag[]    @relation(references: [id])
+  createdAt      DateTime @default(now()) @map("created_at")
+  updatedAt      DateTime @updatedAt      @map("updated_at")
+
+  @@index([locationId], name: "locationId")
+  @@index([categoryId], name: "categoryId")
+
+  @@map(name: "jobs")
+}
+
+model Category {
+  id        Int      @id @default(autoincrement())
+  name      String   @unique
+  jobs      Job[]
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @updatedAt @map("updated_at")
+
+  @@map(name: "categories")
+}
+
+model Location {
+  id        Int      @id @default(autoincrement())
+  name      String   @unique
+  jobs      Job[]
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @updatedAt @map("updated_at")
+
+  @@map(name: "locations")
+}
+
+model Tag {
+  id        Int      @id @default(autoincrement())
+  name      String   @unique
+  jobs      Job[]    @relation(references: [id])
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @updatedAt @map("updated_at")
+
+  @@map(name: "tags")
+}
```


