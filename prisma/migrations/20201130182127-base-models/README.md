# Migration `20201130182127-base-models`

This migration has been generated by lmjcbs at 11/30/2020, 6:21:27 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "jobs" (
"id" SERIAL,
    "jid" TEXT NOT NULL,
    "applyEmail" TEXT,
    "applyUrl" TEXT,
    "companyName" TEXT,
    "descriptionAsHTML" TEXT NOT NULL,
    "epoch" INTEGER NOT NULL,
    "datePosted" TEXT NOT NULL,
    "featured" BOOLEAN NOT NULL DEFAULT false,
    "title" TEXT NOT NULL,
    "locationId" INTEGER NOT NULL,
    "categoryId" INTEGER NOT NULL,
    "companyId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "categories" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "locations" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "tags" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "companies" (
"id" SERIAL,
    "cid" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "descriptionAsHTML" TEXT,
    "headquaters" TEXT NOT NULL,
    "logoUrl" TEXT,
    "name" TEXT NOT NULL,
    "statement" TEXT,
    "verified" BOOLEAN NOT NULL DEFAULT false,
    "websiteUrl" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_JobToTag" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "jobs.jid_unique" ON "jobs"("jid")

CREATE INDEX "locationId" ON "jobs"("locationId")

CREATE INDEX "categoryId" ON "jobs"("categoryId")

CREATE UNIQUE INDEX "categories.name_unique" ON "categories"("name")

CREATE UNIQUE INDEX "locations.name_unique" ON "locations"("name")

CREATE UNIQUE INDEX "tags.name_unique" ON "tags"("name")

CREATE UNIQUE INDEX "companies.cid_unique" ON "companies"("cid")

CREATE UNIQUE INDEX "companies.email_unique" ON "companies"("email")

CREATE UNIQUE INDEX "_JobToTag_AB_unique" ON "_JobToTag"("A", "B")

CREATE INDEX "_JobToTag_B_index" ON "_JobToTag"("B")

ALTER TABLE "jobs" ADD FOREIGN KEY("locationId")REFERENCES "locations"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "jobs" ADD FOREIGN KEY("categoryId")REFERENCES "categories"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "jobs" ADD FOREIGN KEY("companyId")REFERENCES "companies"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "_JobToTag" ADD FOREIGN KEY("A")REFERENCES "jobs"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_JobToTag" ADD FOREIGN KEY("B")REFERENCES "tags"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201130182127-base-models
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,83 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Job {
+  id                Int      @id @default(autoincrement())
+  jid               String   @unique
+  applyEmail        String?
+  applyUrl          String?
+  companyName       String?
+  descriptionAsHTML String
+  epoch             Int
+  datePosted        String
+  featured          Boolean  @default(false)
+  title             String
+  locationId        Int
+  categoryId        Int
+  companyId         Int?
+  location          Location @relation(fields: [locationId], references: [id])
+  category          Category @relation(fields: [categoryId], references: [id])
+  company           Company? @relation(fields: [companyId], references: [id])
+  tags              Tag[]    @relation(references: [id])
+  createdAt         DateTime @default(now())
+  updatedAt         DateTime @updatedAt
+
+
+  @@index([locationId], name: "locationId")
+  @@index([categoryId], name: "categoryId")
+  @@map(name: "jobs")
+}
+
+model Category {
+  id        Int      @id @default(autoincrement())
+  name      String   @unique
+  jobs      Job[]
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@map(name: "categories")
+}
+
+model Location {
+  id        Int      @id @default(autoincrement())
+  name      String   @unique
+  jobs      Job[]
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@map(name: "locations")
+}
+
+model Tag {
+  id        Int      @id @default(autoincrement())
+  name      String   @unique
+  jobs      Job[]    @relation(references: [id])
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@map(name: "tags")
+}
+
+model Company {
+  id                Int      @id @default(autoincrement())
+  cid               String   @unique
+  email             String   @unique
+  descriptionAsHTML String?
+  headquaters       String
+  logoUrl           String?
+  name              String
+  statement         String?
+  verified          Boolean  @default(false)
+  websiteUrl        String
+  jobs              Job[]
+  createdAt         DateTime @default(now())
+  updatedAt         DateTime @updatedAt
+
+  @@map(name: "companies")
+}
```


